<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager - Calendar</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <h1>TaskManager</h1>
            </div>

            <ul class="sidebar-nav">
                <li><a href="dashboard.html">üìä Dashboard</a></li>
                <li><a href="calendar.html" class="active">üìÖ Calendar View</a></li>
                <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
                <li><a href="#" onclick="logout()">üö™ Logout</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="flex items-center">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                    <h2 class="font-semibold">Calendar View</h2>
                </div>

                <div class="user-profile">
                    <span id="userName">Loading...</span>
                    <div class="user-avatar" id="userAvatar">U</div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="flex items-center gap-4">
                            <button class="btn btn-secondary" onclick="previousMonth()">‚Äπ</button>
                            <h2 id="currentMonth" class="text-xl font-semibold"></h2>
                            <button class="btn btn-secondary" onclick="nextMonth()">‚Ä∫</button>
                        </div>

                        <div class="calendar-nav">
                            <button class="btn btn-secondary btn-sm" onclick="goToToday()">Today</button>
                            <button class="btn btn-primary btn-sm" onclick="addNewTask()">+ Add Task</button>
                        </div>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="calendar-grid">
                        <!-- Day headers -->
                        <div class="calendar-day-header"
                            style="background: #f8fafc; padding: 1rem; text-align: center; font-weight: 600;">Sun</div>
                        <div class="calendar-day-header"
                            style="background: #f8fafc; padding: 1rem; text-align: center; font-weight: 600;">Mon</div>
                        <div class="calendar-day-header"
                            style="background: #f8fafc; padding: 1rem; text-align: center; font-weight: 600;">Tue</div>
                        <div class="calendar-day-header"
                            style="background: #f8fafc; padding: 1rem; text-align: center; font-weight: 600;">Wed</div>
                        <div class="calendar-day-header"
                            style="background: #f8fafc; padding: 1rem; text-align: center; font-weight: 600;">Thu</div>
                        <div class="calendar-day-header"
                            style="background: #f8fafc; padding: 1rem; text-align: center; font-weight: 600;">Fri</div>
                        <div class="calendar-day-header"
                            style="background: #f8fafc; padding: 1rem; text-align: center; font-weight: 600;">Sat</div>

                        <!-- Calendar days will be dynamically generated -->
                        <div id="calendarDays"></div>
                    </div>
                </div>

                <!-- Task Preview Panel -->
                <div class="mt-6 bg-white rounded-lg shadow p-6">
                    <h3 class="font-semibold mb-4">Selected Day Tasks</h3>
                    <div id="selectedDayTasks">
                        <p class="text-gray-500">Click on a day to view tasks</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Detail Modal (reused from dashboard) -->
    <div id="taskModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Task Details</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle" class="form-label">Task Title</label>
                        <input type="text" id="taskTitle" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="taskDescription" class="form-label">Description</label>
                        <textarea id="taskDescription" class="form-input" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="taskDueDate" class="form-label">Due Date</label>
                        <input type="date" id="taskDueDate" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="taskPriority" class="form-label">Priority</label>
                        <select id="taskPriority" class="form-input">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="taskStatus" class="form-label">Status</label>
                        <select id="taskStatus" class="form-input">
                            <option value="incomplete">Incomplete</option>
                            <option value="in-progress">In Progress</option>
                            <option value="complete">Complete</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="taskOwner" class="form-label">Assigned To</label>
                        <select id="taskOwner" class="form-input">
                            <option value="Admin User">Admin User</option>
                            <option value="John Doe">John Doe</option>
                            <option value="Sarah Smith">Sarah Smith</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveTask()">Save Task</button>
            </div>
        </div>
    </div>

    <script>
        // Calendar-specific variables
        let currentDate = new Date();
        let selectedDate = null;
        let currentUser = null;
        let tasks = [];
        let editingTaskId = null;

        // Initialize calendar
        document.addEventListener('DOMContentLoaded', function () {
            // Check if user is logged in
            const userData = localStorage.getItem('currentUser');
            if (!userData) {
                window.location.href = 'index.html';
                return;
            }

            currentUser = JSON.parse(userData);

            // Load tasks
            const savedTasks = localStorage.getItem('tasks');
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }

            initializeUI();
            renderCalendar();
            setupEventListeners();
        });

        function initializeUI() {
            // Set user info
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
        }

        function setupEventListeners() {
            // Modal close on backdrop click
            document.getElementById('taskModal').addEventListener('click', function (e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        function renderCalendar() {
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];

            document.getElementById('currentMonth').textContent =
                `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);

                const dayElement = createCalendarDay(date);
                calendarDays.appendChild(dayElement);
            }
        }

        function createCalendarDay(date) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';

            const isCurrentMonth = date.getMonth() === currentDate.getMonth();
            const isToday = date.toDateString() === new Date().toDateString();
            const isSelected = selectedDate && date.toDateString() === selectedDate.toDateString();

            if (!isCurrentMonth) {
                dayElement.style.opacity = '0.3';
            }

            if (isToday) {
                dayElement.style.backgroundColor = '#eff6ff';
                dayElement.style.borderLeft = '4px solid #2563eb';
            }

            if (isSelected) {
                dayElement.style.backgroundColor = '#f0f9ff';
                dayElement.style.borderLeft = '4px solid #0ea5e9';
            }

            dayElement.innerHTML = `
                <div class="calendar-day-header">${date.getDate()}</div>
                <div class="calendar-day-tasks" id="tasks-${date.toISOString().split('T')[0]}"></div>
            `;

            // Add tasks for this day
            const dayTasks = getTasksForDate(date);
            const tasksContainer = dayElement.querySelector('.calendar-day-tasks');

            dayTasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'calendar-task';
                taskElement.textContent = task.title;
                taskElement.style.backgroundColor = getPriorityColor(task.priority);
                taskElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    editTask(task.id);
                });
                tasksContainer.appendChild(taskElement);
            });

            // Add click handler for day selection
            dayElement.addEventListener('click', () => {
                selectedDate = new Date(date);
                renderCalendar();
                showTasksForDate(date);
            });

            return dayElement;
        }

        function getTasksForDate(date) {
            const dateString = date.toISOString().split('T')[0];
            return tasks.filter(task => task.dueDate === dateString);
        }

        function getPriorityColor(priority) {
            switch (priority) {
                case 'high': return '#fee2e2';
                case 'medium': return '#fef3c7';
                case 'low': return '#dcfce7';
                default: return '#f1f5f9';
            }
        }

        function showTasksForDate(date) {
            const dayTasks = getTasksForDate(date);
            const container = document.getElementById('selectedDayTasks');

            if (dayTasks.length === 0) {
                container.innerHTML = `
                    <p class="text-gray-500">No tasks for ${date.toLocaleDateString()}</p>
                `;
                return;
            }

            container.innerHTML = `
                <h4 class="font-medium mb-2">Tasks for ${date.toLocaleDateString()}</h4>
                ${dayTasks.map(task => `
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded mb-2">
                        <div>
                            <div class="font-medium">${task.title}</div>
                            <div class="text-sm text-gray-600">${task.owner} ‚Ä¢ ${task.priority} priority</div>
                        </div>
                        <div class="flex gap-2">
                            <span class="status-badge status-${task.status}">${task.status.replace('-', ' ').toUpperCase()}</span>
                            <button class="btn btn-secondary btn-sm" onclick="editTask(${task.id})">Edit</button>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            selectedDate = new Date();
            renderCalendar();
            showTasksForDate(new Date());
        }

        // Task management functions (shared with dashboard)
        function addNewTask() {
            editingTaskId = null;
            document.getElementById('taskForm').reset();
            document.getElementById('taskOwner').value = currentUser.name;

            // If a date is selected, pre-fill the due date
            if (selectedDate) {
                document.getElementById('taskDueDate').value = selectedDate.toISOString().split('T')[0];
            }

            document.querySelector('.modal-title').textContent = 'Add New Task';
            document.getElementById('taskModal').classList.remove('hidden');
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                editingTaskId = taskId;

                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskDueDate').value = task.dueDate;
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskStatus').value = task.status;
                document.getElementById('taskOwner').value = task.owner;

                document.querySelector('.modal-title').textContent = 'Edit Task';
                document.getElementById('taskModal').classList.remove('hidden');
            }
        }

        function saveTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const dueDate = document.getElementById('taskDueDate').value;
            const priority = document.getElementById('taskPriority').value;
            const status = document.getElementById('taskStatus').value;
            const owner = document.getElementById('taskOwner').value;

            if (!title || !dueDate) {
                alert('Please fill in all required fields');
                return;
            }

            if (editingTaskId) {
                const task = tasks.find(t => t.id === editingTaskId);
                if (task) {
                    task.title = title;
                    task.description = description;
                    task.dueDate = dueDate;
                    task.priority = priority;
                    task.status = status;
                    task.owner = owner;
                }
            } else {
                const newTask = {
                    id: Date.now(),
                    title,
                    description,
                    dueDate,
                    priority,
                    status,
                    owner,
                    createdAt: new Date().toISOString()
                };
                tasks.push(newTask);
            }

            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderCalendar();

            if (selectedDate) {
                showTasksForDate(selectedDate);
            }

            closeModal();
        }

        function closeModal() {
            document.getElementById('taskModal').classList.add('hidden');
            editingTaskId = null;
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && !document.getElementById('taskModal').classList.contains('hidden')) {
                closeModal();
            }

            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                addNewTask();
            }
        });
    </script>
</body>

</html>